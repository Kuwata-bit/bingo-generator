<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ビンゴカードジェネレーター</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        h1 {
            margin-bottom: 20px;
        }
        table {
            border-collapse: collapse;
            margin-bottom: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid black;
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
        th {
            background-color: #f0f0f0;
        }
        td.free-spot {
            background-color: #e0e0e0;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        td.selected {
            background-color: #ffb703; /* 例: オレンジ色 */
            color: #2b2d42; /* 文字色を濃くする */
        }
        td.selected.free-spot { /* FREEマスが選択された時のスタイル */
            background-color: #fb8500;
            color: white;
        } /* ← CSSの閉じ括弧を修正済み */
    </style>
</head>
<body>
    <h1>ビンゴカード</h1>
    <table id="bingoCard">
        <thead>
            <tr>
                <th>B</th>
                <th>I</th>
                <th>N</th>
                <th>G</th>
                <th>O</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>
    <button id="generateButton">新しいカードを生成</button>
    <div id="bingoMessage" style="display:none; font-size: 48px; font-weight: bold; color: red; text-align: center; margin-top: 20px;">ビンゴ！</div>

    <script>
        const bingoCardTableBody = document.querySelector("#bingoCard tbody");
        const generateButton = document.getElementById("generateButton");
        const bingoMessageElement = document.getElementById("bingoMessage");

        let cardState = [];
        let bingoAchieved = false;

        function initializeCardState() {
            cardState = [];
            for (let i = 0; i < 5; i++) {
                cardState[i] = [false, false, false, false, false];
            }
            cardState[2][2] = true; // FREEマスは最初から選択状態
            bingoAchieved = false;
            if (bingoMessageElement) {
                bingoMessageElement.style.display = 'none';
            }
        }

        function getRandomUniqueNumbers(min, max, count) {
            const numbers = [];
            while (numbers.length < count) {
                const randomNumber = Math.floor(Math.random() * (max - min + 1)) + min;
                if (!numbers.includes(randomNumber)) {
                    numbers.push(randomNumber);
                }
            }
            return numbers;
        }

        // マスがクリックされたときの処理 (デバッグログ追加版)
        function handleCellClick(event) {
            console.log("handleCellClickが呼ばれました！"); // ★追加：関数が呼ばれたか確認
            console.log("クリックされた要素:", event.target); // ★追加：どの要素がクリックされたか
            const cell = event.target;
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            console.log("セル情報: row=" + row + ", col=" + col); // ★追加：行と列の情報

            if (bingoAchieved) {
                console.log("既にビンゴ達成済みのため処理中断"); // ★追加
                return;
            }

            // FREEマス (2,2) はクリックで状態を変更しない (常に選択状態)
            if (row === 2 && col === 2) {
                console.log("FREEマスがクリックされました"); // ★追加
                return;
            }

            cell.classList.toggle('selected');
            cardState[row][col] = cell.classList.contains('selected');
            console.log("選択状態変更後: cardState[" + row + "][" + col + "] = " + cardState[row][col]); // ★追加

            checkBingo();
        }

        function checkBingo() {
            // 横ラインのチェック
            for (let i = 0; i < 5; i++) {
                if (cardState[i][0] && cardState[i][1] && cardState[i][2] && cardState[i][3] && cardState[i][4]) {
                    announceBingo();
                    return;
                }
            }
            // 縦ラインのチェック
            for (let j = 0; j < 5; j++) {
                if (cardState[0][j] && cardState[1][j] && cardState[2][j] && cardState[3][j] && cardState[4][j]) {
                    announceBingo();
                    return;
                }
            }
            // 斜めラインのチェック (左上から右下)
            if (cardState[0][0] && cardState[1][1] && cardState[2][2] && cardState[3][3] && cardState[4][4]) {
                announceBingo();
                return;
            }
            // 斜めラインのチェック (右上から左下)
            if (cardState[0][4] && cardState[1][3] && cardState[2][2] && cardState[3][1] && cardState[4][0]) {
                announceBingo();
                return;
            }
        }

        function announceBingo() {
            bingoAchieved = true;
            if (bingoMessageElement) {
                bingoMessageElement.style.display = 'block';
            }
        }

        function generateBingoCard() {
            bingoCardTableBody.innerHTML = '';
            initializeCardState();

            const cardNumbers = {
                B: getRandomUniqueNumbers(1, 15, 5),
                I: getRandomUniqueNumbers(16, 30, 5),
                N: [], // N列は別途処理
                G: getRandomUniqueNumbers(46, 60, 5),
                O: getRandomUniqueNumbers(61, 75, 5)
            };
            const nColumnNumbers = getRandomUniqueNumbers(31, 45, 4);

            for (let i = 0; i < 5; i++) {
                const tr = document.createElement("tr");
                for (let j = 0; j < 5; j++) {
                    const td = document.createElement("td");
                    td.dataset.row = i;
                    td.dataset.col = j;

                    if (j === 2 && i === 2) {
                        td.textContent = "FREE";
                        td.classList.add("free-spot");
                        td.classList.add("selected");
                    } else {
                        let num;
                        switch (j) {
                            case 0: num = cardNumbers.B[i]; break;
                            case 1: num = cardNumbers.I[i]; break;
                            case 2: // N列 (中央以外)
                                if (i < 2) num = nColumnNumbers[i];
                                else if (i > 2) num = nColumnNumbers[i-1];
                                break;
                            case 3: num = cardNumbers.G[i]; break;
                            case 4: num = cardNumbers.O[i]; break;
                        }
                        td.textContent = num;
                    }
                    td.addEventListener('click', handleCellClick);
                    tr.appendChild(td);
                }
                bingoCardTableBody.appendChild(tr);
            }
        }

        generateButton.addEventListener("click", generateBingoCard);
        generateBingoCard();
    </script>
</body>
</html>
