<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ビンゴカードジェネレーター</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        h1 {
            margin-bottom: 20px;
        }
        table {
            border-collapse: collapse;
            margin-bottom: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid black;
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
        th {
            background-color: #f0f0f0;
        }
        td.free-spot {
            background-color: #e0e0e0;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        td.selected {
            background-color: #ffb703; /* 例: オレンジ色 */
            color: #2b2d42; /* 文字色を濃くする */
        }
        td.selected.free-spot { /* FREEマスが選択された時のスタイル (基本はselectedと同じで良いが、区別したい場合) */
            background-color: #fb8500;
            color: white;}/*
    </style>
</head>
<body>
    <h1>ビンゴカード</h1>
    <table id="bingoCard">
        <thead>
            <tr>
                <th>B</th>
                <th>I</th>
                <th>N</th>
                <th>G</th>
                <th>O</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>
    <button id="generateButton">新しいカードを生成</button>
　　<div id="bingoMessage" style="display:none; font-size: 48px; font-weight: bold; color: red; text-align: center; margin-top: 20px;">ビンゴ！</div>
    <script>
       const bingoCardTableBody = document.querySelector("#bingoCard tbody");
        const generateButton = document.getElementById("generateButton");
        const bingoMessageElement = document.getElementById("bingoMessage"); // HTMLに追加した要素を取得

        let cardState = []; // 5x5のカードの選択状態を保持 (true:選択済, false:未選択)
        let bingoAchieved = false; // ビンゴが達成されたかどうかのフラグ

        // カードの状態を初期化する関数
        function initializeCardState() {
            cardState = [];
            for (let i = 0; i < 5; i++) {
                cardState[i] = [false, false, false, false, false];
            }
            // 中央のFREEマスは最初から選択状態とする
            cardState[2][2] = true;
            bingoAchieved = false; // ビンゴ状態をリセット
            if (bingoMessageElement) {
                bingoMessageElement.style.display = 'none'; // 「ビンゴ！」メッセージを隠す
            }
        }

        // 指定された範囲から指定された個数のランダムなユニークな数値を取得する関数 (変更なし)
        function getRandomUniqueNumbers(min, max, count) {
            const numbers = [];
            while (numbers.length < count) {
                const randomNumber = Math.floor(Math.random() * (max - min + 1)) + min;
                if (!numbers.includes(randomNumber)) {
                    numbers.push(randomNumber);
                }
            }
            return numbers;
        }

        // マスがクリックされたときの処理
        function handleCellClick(event) {
            if (bingoAchieved) return; // 既にビンゴが達成されていたら何もしない

            const cell = event.target;
            // data属性から行と列のインデックスを取得
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);

            // FREEマス (2,2) はクリックで状態を変更しない (常に選択状態)
            if (row === 2 && col === 2) {
                return;
            }

            // 選択状態をトグルし、cardStateを更新
            cell.classList.toggle('selected');
            cardState[row][col] = cell.classList.contains('selected');

            checkBingo(); // ビンゴが成立したかチェック
        }

        // ビンゴが成立したかチェックする関数
        function checkBingo() {
            // 横ラインのチェック
            for (let i = 0; i < 5; i++) {
                if (cardState[i][0] && cardState[i][1] && cardState[i][2] && cardState[i][3] && cardState[i][4]) {
                    announceBingo();
                    return;
                }
            }

            // 縦ラインのチェック
            for (let j = 0; j < 5; j++) {
                if (cardState[0][j] && cardState[1][j] && cardState[2][j] && cardState[3][j] && cardState[4][j]) {
                    announceBingo();
                    return;
                }
            }

            // 斜めラインのチェック (左上から右下)
            if (cardState[0][0] && cardState[1][1] && cardState[2][2] && cardState[3][3] && cardState[4][4]) {
                announceBingo();
                return;
            }

            // 斜めラインのチェック (右上から左下)
            if (cardState[0][4] && cardState[1][3] && cardState[2][2] && cardState[3][1] && cardState[4][0]) {
                announceBingo();
                return;
            }
        }

        // ビンゴ成立を知らせる関数
        function announceBingo() {
            bingoAchieved = true;
            if (bingoMessageElement) {
                bingoMessageElement.style.display = 'block';
            }
            // ここで、これ以上マスをクリックできないようにするなどの処理も追加可能
        }

        // ビンゴカードを生成して表示する関数 (変更・追加あり)
        function generateBingoCard() {
            bingoCardTableBody.innerHTML = ''; // tbody の中身をクリア
            initializeCardState(); // カード状態を初期化

            const cardNumbers = {
                B: getRandomUniqueNumbers(1, 15, 5),
                I: getRandomUniqueNumbers(16, 30, 5),
                N: [], // N列は中央FREEのため別途処理するので空で初期化
                G: getRandomUniqueNumbers(46, 60, 5),
                O: getRandomUniqueNumbers(61, 75, 5)
            };
            // N列用の数字4つを準備
            const nColumnNumbers = getRandomUniqueNumbers(31, 45, 4);

            // HTMLテーブルに行とセルを生成して挿入
            for (let i = 0; i < 5; i++) { // 5行
                const tr = document.createElement("tr");
                for (let j = 0; j < 5; j++) { // 5列
                    const td = document.createElement("td");
                    td.dataset.row = i; // data属性に行インデックスを保存
                    td.dataset.col = j; // data属性に列インデックスを保存

                    if (j === 2 && i === 2) { // 中央のマス (N列の3行目)
                        td.textContent = "FREE";
                        td.classList.add("free-spot");
                        td.classList.add("selected"); // FREEマスは最初から選択状態
                    } else {
                        let num;
                        switch (j) {
                            case 0: num = cardNumbers.B[i]; break;
                            case 1: num = cardNumbers.I[i]; break;
                            case 2: // N列 (中央以外)
                                if (i < 2) num = nColumnNumbers[i];       // 0,1番目の要素
                                else if (i > 2) num = nColumnNumbers[i-1]; // 2,3番目の要素 (中央を飛ばすためインデックス調整)
                                break;
                            case 3: num = cardNumbers.G[i]; break;
                            case 4: num = cardNumbers.O[i]; break;
                        }
                        td.textContent = num;
                    }
                    td.addEventListener('click', handleCellClick); // すべてのセルにクリックイベントを追加
                    tr.appendChild(td);
                }
                bingoCardTableBody.appendChild(tr);
            }
        }

        // ボタンのクリックイベントリスナー (変更なし)
        generateButton.addEventListener("click", generateBingoCard);

        // 初期表示時にカードを1枚生成 (変更なし)
        generateBingoCard();
    </script>
</body>
</html>
